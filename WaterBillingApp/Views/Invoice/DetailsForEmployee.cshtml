@using WaterBillingApp.Data.Entities
@model WaterBillingApp.Data.Entities.Invoice

@{
    ViewData["Title"] = "Invoice Details";
}

<!-- Page heading -->
<h1 class="mb-4">@ViewData["Title"]</h1>

<div class="card shadow-sm">
    <div class="card-body">
        <!-- General invoice information section -->
        <h5 class="mb-3 text-primary">General Information</h5>
        <dl class="row">
            <!-- Invoice ID -->
            <dt class="col-sm-4">Invoice ID</dt>
            <dd class="col-sm-8">@Model.Id</dd>

            <!-- Issue date of the invoice -->
            <dt class="col-sm-4">Issue Date</dt>
            <dd class="col-sm-8">@Model.IssueDate.ToString("dd/MM/yyyy")</dd>

            <!-- Invoice status with colored badge -->
            <dt class="col-sm-4">Status</dt>
            <dd class="col-sm-8">
                <span class="badge
                    @(Model.Status == InvoiceStatus.Approved ? "bg-success" :
                                            Model.Status == InvoiceStatus.Pending ? "bg-warning text-dark" :
                                            Model.Status == InvoiceStatus.Rejected ? "bg-danger" : "bg-secondary")">
                    @Model.Status
                </span>
            </dd>

            <!-- Total amount formatted as currency -->
            <dt class="col-sm-4">Total Amount</dt>
            <dd class="col-sm-8">@Model.TotalAmount.ToString("C")</dd>
        </dl>

        <!-- Consumption details section -->
        <h5 class="mt-4 mb-3 text-primary">Consumption Information</h5>
        @if (Model.Consumption != null)
        {
            <dl class="row">
                <!-- Date of consumption reading -->
                <dt class="col-sm-4">Reading Date</dt>
                <dd class="col-sm-8">@Model.Consumption.Date.ToString("dd/MM/yyyy")</dd>

                <!-- Volume of water consumed, formatted to 2 decimals -->
                <dt class="col-sm-4">Volume Consumed</dt>
                <dd class="col-sm-8">@Model.Consumption.Volume.ToString("N2") m³</dd>

                <!-- Tariff details if available -->
                <dt class="col-sm-4">Applied Tariff</dt>
                <dd class="col-sm-8">
                    @if (Model.Consumption.TariffBracket != null)
                    {
                        <span>
                            €@Model.Consumption.TariffBracket.PricePerCubicMeter /m³
                            (from @Model.Consumption.TariffBracket.MinVolume
                            to @(Model.Consumption.TariffBracket.MaxVolume?.ToString() ?? "no limit") m³)
                        </span>
                    }
                    else
                    {
                        <!-- Warning if no tariff is applied -->
                        <span class="text-danger">No tariff applied</span>
                    }
                </dd>
            </dl>
        }
        else
        {
            <!-- Message when no consumption data is available -->
            <p class="text-muted">No consumption information available.</p>
        }

        <!-- Meter and customer information section -->
        <h5 class="mt-4 mb-3 text-primary">Meter & Customer</h5>
        @if (Model.Consumption?.Meter != null)
        {
            <dl class="row">
                <!-- Meter serial number -->
                <dt class="col-sm-4">Meter Serial Number</dt>
                <dd class="col-sm-8">@Model.Consumption.Meter.SerialNumber</dd>

                <!-- Customer full name or 'Unknown' if null -->
                <dt class="col-sm-4">Customer Name</dt>
                <dd class="col-sm-8">@Model.Consumption.Meter.Customer?.FullName ?? "Unknown"</dd>
            </dl>
        }
        else
        {
            <!-- Message when meter or customer info is missing -->
            <p class="text-muted">No meter or customer information available.</p>
        }
    </div>
</div>

<!-- Button to return to employee invoice list -->
<a asp-action="InvoicesForEmployee" asp-controller="Invoice" class="btn btn-secondary mt-4">
    ← Back to Invoices
</a>
